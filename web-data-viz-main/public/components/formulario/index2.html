<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo — componente <formulario-generico></title>
  <!-- IMPORTANTE: você disse que vai importar o script do componente. -->
  <!-- Ex.: <script type="module" src="./formulario-generico.js"></script> -->
  <style>
    :root {
      --ui-border: #e5e7eb;
      --ui-muted: #6b7280;
    }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 0; color: #111827; background: #fafafa; }
    header { padding: 24px; background: white; border-bottom: 1px solid var(--ui-border); position: sticky; top: 0; z-index: 10; }
    h1 { margin: 0 0 8px; font-size: 20px; }
    p.lead { margin: 0; color: var(--ui-muted); }

    main { padding: 24px; display: grid; gap: 24px; grid-template-columns: 1fr; max-width: 1200px; margin: 0 auto; }
    .grid { display: grid; gap: 24px; grid-template-columns: 1fr; }
    @media (min-width: 980px) { .grid { grid-template-columns: 1fr 1fr; } }

    .card { background: white; border: 1px solid var(--ui-border); border-radius: 12px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .card header { padding: 16px 20px; border-bottom: 1px solid var(--ui-border); position: static; }
    .card .body { padding: 16px 20px; }
    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .toolbar .group { display: flex; gap: 8px; align-items: center; }

    button, select, input[type="text"], input[type="number"] { padding: 10px 12px; border-radius: 10px; border: 1px solid var(--ui-border); background: #fff; cursor: pointer; font-weight: 600; }
    button.primary { background: #3b82f6; color: #fff; border-color: #3b82f6; }
    button.ghost { background: transparent; }
    button:disabled { opacity: .5; cursor: not-allowed; }

    pre { background: #0b1021; color: #e5e7eb; padding: 16px; border-radius: 8px; overflow: auto; max-height: 320px; font-size: 12px; }
    .muted { color: var(--ui-muted); font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <h1>Demo completa — <code>&lt;formulario-generico&gt;</code></h1>
    <p class="lead">Exercita <strong>todas</strong> as funcionalidades: popup, inline, paginação, scroll, validação em tempo real, múltiplos tipos de campo, acessibilidade e API pública (abrir/fechar/validar/preencher/obter/limpar).</p>
  </header>

  <main>
    <!-- ============================= LEFT: POPUP ============================= -->
    <section class="card" aria-labelledby="ttl-popup">
      <header>
        <h2 id="ttl-popup">Modo Popup (padrão)</h2>
      </header>
      <div class="body">
        <div class="toolbar" role="group" aria-label="Ações do popup">
          <button id="btnAbrirPopup" class="primary" aria-controls="formPopup">Abrir popup</button>
          <button id="btnPreencherPopup">Preencher dados de teste</button>
          <button id="btnValidarPopup" class="ghost">Validar</button>
          <button id="btnObterPopup" class="ghost">Obter dados</button>
          <button id="btnLimparPopup" class="ghost">Limpar</button>
          <span class="muted">Título:</span>
          <input id="inpTituloPopup" type="text" value="Cadastro (Popup)" aria-label="Título do popup" />
          <button id="btnAplicarTituloPopup">Aplicar</button>
        </div>

        <!-- Instância POPUP (visível=false no start) -->
        <formulario-generico id="formPopup"
          titulo="Cadastro (Popup)"
          visivel="false"
          texto-botao="Enviar cadastro"
          campos='[]'>
        </formulario-generico>

        <p class="muted">Eventos disparados do popup aparecerão no log abaixo.</p>
        <pre id="logPopup" aria-live="polite">// log do popup…</pre>
      </div>
    </section>

    <!-- ============================= RIGHT: INLINE ============================ -->
    <section class="card" aria-labelledby="ttl-inline">
      <header>
        <h2 id="ttl-inline">Modo Inline (com paginação e scroll)</h2>
      </header>
      <div class="body">
        <div class="toolbar" role="group" aria-label="Atributos e ações do inline">
          <div class="group">
            <label for="selCamposPagina" class="muted">Campos/página</label>
            <input id="selCamposPagina" type="number" min="1" max="10" value="4" style="width: 88px;" />
            <button id="btnAplicarPaginacao">Aplicar</button>
          </div>
          <div class="group">
            <label for="inpAltura" class="muted">Altura máx (scroll)</label>
            <input id="inpAltura" type="text" value="380px" style="width: 120px;" />
            <button id="btnAplicarAltura">Aplicar</button>
          </div>
          <div class="group">
            <button id="btnAlternarPaginacao">Alternar paginação</button>
            <button id="btnPreencherInline">Preencher teste</button>
            <button id="btnValidarInline" class="ghost">Validar</button>
            <button id="btnObterInline" class="ghost">Obter dados</button>
            <button id="btnLimparInline" class="ghost">Limpar</button>
          </div>
        </div>

        <!-- Instância INLINE -->
        <formulario-generico id="formInline"
          modo="inline"
          titulo="Cadastro (Inline)"
          texto-botao="Salvar"
          paginacao="true"
          campos-por-pagina="4"
          altura-maxima="380px"
          campos='[]'>
        </formulario-generico>

        <p class="muted">Eventos disparados do inline aparecerão no log abaixo.</p>
        <pre id="logInline" aria-live="polite">// log do inline…</pre>
      </div>
    </section>

    <!-- ============================= DATA OUT ================================= -->
    <section class="card" aria-labelledby="ttl-out">
      <header>
        <h2 id="ttl-out">Saída de dados (dump em tempo real)</h2>
      </header>
      <div class="body">
        <p class="muted">Resultados de <em>obterDados()</em> e eventos <code>submit</code> são exibidos aqui:</p>
        <pre id="out">{}</pre>
      </div>
    </section>
  </main>
  <script type="module" src="./formulario.js"></script>
  <script>
    // ================================ CAMPOS (amostras completas) ================================
    const CAMPOS_COMUNS = [
      { id: 'nome', label: 'Nome completo', tipo: 'text', placeholder: 'Seu nome', obrigatorio: true, min: 3, dica: 'Informe nome e sobrenome.' },
      { id: 'email', label: 'E-mail', tipo: 'email', placeholder: 'voce@empresa.com', obrigatorio: true },
      { id: 'telefone', label: 'Telefone', tipo: 'tel', placeholder: '(11) 99999-9999', obrigatorio: true },
      { id: 'cpf', label: 'CPF', tipo: 'cpf', placeholder: '000.000.000-00', obrigatorio: true },
      { id: 'site', label: 'Website/URL', tipo: 'url', placeholder: 'https://…' },

      { id: 'senha', label: 'Senha', tipo: 'senha', placeholder: 'Crie uma senha', obrigatorio: true, min: 8, mostrarForca: true, dica: 'Use letras, números e símbolos.' },
      { id: 'confirmarSenha', label: 'Confirmar senha', tipo: 'password', placeholder: 'Repita a senha', obrigatorio: true, regex: '^.{8,}$', mensagemErro: 'Repita a mesma senha com 8+ caracteres' },

      { id: 'perfil', label: 'Perfil', tipo: 'select', placeholder: 'Selecione…', opcoes: [
          { valor: 'adm', texto: 'Administrador' },
          { valor: 'op', texto: 'Operacional' },
          { valor: 'fin', texto: 'Financeiro' },
          { valor: 'rh', texto: 'RH' },
        ], obrigatorio: true },

      { id: 'turno', label: 'Turno de trabalho', tipo: 'radio', obrigatorio: true, opcoes: [
          { valor: 'manha', texto: 'Manhã' },
          { valor: 'tarde', texto: 'Tarde' },
          { valor: 'noite', texto: 'Noite' },
        ] },

      { id: 'salario', label: 'Pretensão salarial (R$)', tipo: 'number', placeholder: 'Ex.: 3500', minValue: 1200, maxValue: 25000, dica: 'Entre 1.200 e 25.000.' },
      { id: 'bio', label: 'Resumo profissional', tipo: 'textarea', linhas: 4, placeholder: 'Conte brevemente sua experiência…', max: 500 },

      { id: 'aceite', label: 'Aceito os termos', tipo: 'checkbox', obrigatorio: true },
      { id: 'codigoRef', label: 'Código de referência', tipo: 'text', placeholder: 'Ex.: TAG-04', regex: '^[A-Za-z0-9_-]{3,}$', mensagemErro: 'Use 3+ caracteres válidos (letras/números/_-).' },

      { id: 'interno', label: 'Campo interno (oculto)', tipo: 'text', valor: 'hidden-123', oculto: true }
    ];

    // Popup e Inline podem ter variações específicas
    const CAMPOS_POPUP = CAMPOS_COMUNS;
    const CAMPOS_INLINE = [
      ...CAMPOS_COMUNS,
      { id: 'obs', label: 'Observações adicionais', tipo: 'textarea', linhas: 3, placeholder: 'Detalhes importantes…' }
    ];

    // ================================ HELPERS UI ================================
    const $ = (sel) => document.querySelector(sel);
    const log = (el, msg) => {
      const now = new Date().toLocaleTimeString();
      el.textContent = `${el.textContent}\n[${now}] ${msg}`.trim();
      el.scrollTop = el.scrollHeight;
    };
    const printOut = (obj) => { $('#out').textContent = JSON.stringify(obj, null, 2); };

    // ================================ SETUP SEGURO ==============================
    const quandoDefinido = () => customElements.whenDefined('formulario-generico');

    // Elementos DOM
    const formPopup = $('#formPopup');
    const formInline = $('#formInline');
    const logPopup = $('#logPopup');
    const logInline = $('#logInline');

    // Carrega campos assim que o componente estiver definido
    quandoDefinido().then(() => {
      formPopup.setAttribute('campos', JSON.stringify(CAMPOS_POPUP));
      formInline.setAttribute('campos', JSON.stringify(CAMPOS_INLINE));
    });

    // ================================ EVENTOS DO COMPONENTE =====================
    const bindEventos = (el, logEl, nome) => {
      el.addEventListener('form-pronto', () => log(logEl, `${nome}: form-pronto`));
      el.addEventListener('fechou', () => log(logEl, `${nome}: fechou`));
      el.addEventListener('cancelou', () => log(logEl, `${nome}: cancelou`));
      el.addEventListener('submit', (e) => {
        log(logEl, `${nome}: submit`);
        printOut({ origem: nome, dados: e.detail });
      });
    };

    bindEventos(formPopup, logPopup, 'Popup');
    bindEventos(formInline, logInline, 'Inline');

    // ================================ CONTROLES POPUP ===========================
    $('#btnAbrirPopup').addEventListener('click', () => formPopup.abrir());
    $('#btnPreencherPopup').addEventListener('click', () => {
      formPopup.preencherDados({
        nome: 'Maria Andrade',
        email: 'maria@empresa.com',
        telefone: '(11) 98888-7777',
        cpf: '123.456.789-10',
        site: 'https://suatec.com.br',
        senha: 'SenhaF0rte!2025',
        confirmarSenha: 'SenhaF0rte!2025',
        perfil: 'rh',
        turno: 'tarde',
        salario: 5200,
        bio: 'Profissional com experiência em climatização corporativa.',
        aceite: true,
        codigoRef: 'TAG-04'
      });
    });
    $('#btnValidarPopup').addEventListener('click', () => {
      const ok = formPopup.validar();
      log(logPopup, `Popup: validar() => ${ok}`);
    });
    $('#btnObterPopup').addEventListener('click', () => printOut({ origem: 'Popup', dados: formPopup.obterDados() }));
    $('#btnLimparPopup').addEventListener('click', () => formPopup.limparFormulario());
    $('#btnAplicarTituloPopup').addEventListener('click', () => {
      const titulo = $('#inpTituloPopup').value || 'Cadastro (Popup)';
      formPopup.setAttribute('titulo', titulo);
    });

    // ================================ CONTROLES INLINE ==========================
    $('#btnPreencherInline').addEventListener('click', () => {
      formInline.preencherDados({
        nome: 'João Silva', email: 'joao@empresa.com', telefone: '(11) 97777-1234', cpf: '987.654.321-00',
        site: 'https://exemplo.com', senha: 'Sup3r!Senha', confirmarSenha: 'Sup3r!Senha', perfil: 'op', turno: 'manha',
        salario: 3500, bio: 'Técnico com 5 anos de experiência.', aceite: true, codigoRef: 'AH-31', obs: 'Pode trabalhar em altura.'
      });
    });
    $('#btnValidarInline').addEventListener('click', () => {
      const ok = formInline.validar();
      log(logInline, `Inline: validar() => ${ok}`);
    });
    $('#btnObterInline').addEventListener('click', () => printOut({ origem: 'Inline', dados: formInline.obterDados() }));
    $('#btnLimparInline').addEventListener('click', () => formInline.limparFormulario());

    // Paginação dinâmica
    $('#btnAplicarPaginacao').addEventListener('click', () => {
      const n = Number($('#selCamposPagina').value) || 4;
      formInline.setAttribute('paginacao', 'true');
      formInline.setAttribute('campos-por-pagina', String(n));
      log(logInline, `Inline: campos-por-pagina=${n}`);
    });
    $('#btnAlternarPaginacao').addEventListener('click', () => {
      const atual = formInline.getAttribute('paginacao');
      const prox = (atual === 'true') ? 'false' : 'true';
      formInline.setAttribute('paginacao', prox);
      log(logInline, `Inline: paginacao=${prox}`);
    });

    // Scroll/altura
    $('#btnAplicarAltura').addEventListener('click', () => {
      const altura = $('#inpAltura').value || '380px';
      formInline.setAttribute('altura-maxima', altura);
      log(logInline, `Inline: altura-maxima=${altura}`);
    });

    // Segurança para evitar chamadas antes do upgrade do custom element
    if (!window.customElements || !customElements.get('formulario-generico')) {
      console.warn('[demo] Aguardando definição de <formulario-generico>. Importe o script conforme indicado no topo do arquivo.');
    }
  </script>
</body>
</html>